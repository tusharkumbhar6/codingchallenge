from openpyxl import Workbook

def expand_weekday_field(weekday: str) -> str:
    """
    Convert a cron weekday field into readable English.
    Supports:
        "*"
        "1"
        "1,3,5"
        "1-5"
        "0-1,3-6"
        "1,3-5,6"
    """
    weekday_map = {
        "0": "Sunday", "1": "Monday", "2": "Tuesday",
        "3": "Wednesday", "4": "Thursday",
        "5": "Friday", "6": "Saturday", "7": "Sunday"
    }

    if weekday == "*":
        return "every"

    parts = []

    tokens = weekday.split(",")
    for token in tokens:
        token = token.strip()

        if "-" in token:  # range
            start, end = token.split("-", 1)
            start_name = weekday_map.get(start, start)
            end_name = weekday_map.get(end, end)
            parts.append(f"{start_name} to {end_name}")
        else:  # single day
            parts.append(weekday_map.get(token, token))

    if len(parts) == 1:
        return f"Every {parts[0]}"
    else:
        return "Every " + ", ".join(parts)


def cron_to_row(cron_expr: str):
    parts = cron_expr.split()
    if len(parts) != 5:
        return None

    minute, hour, date, month, weekday = parts
    readable_day = expand_weekday_field(weekday)

    return [cron_expr, minute, hour, date, month, readable_day]


# ----------------------------------------
# Read input file
# ----------------------------------------
input_file = "crons.txt"
output_excel = "cron_output.xlsx"

rows = []
with open(input_file, "r") as f:
    for line in f:
        cron = line.strip()
        if not cron:
            continue

        parsed = cron_to_row(cron)
        if parsed:
            rows.append(parsed)


# ----------------------------------------
# Write to Excel
# ----------------------------------------
wb = Workbook()
ws = wb.active
ws.title = "Cron Output"

# Header row
ws.append(["cronschedule", "min", "hour", "date", "month", "day"])

# Data rows
for row in rows:
    ws.append(row)

wb.save(output_excel)

print("\nâœ… Excel file saved as:", output_excel)
